<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Environment Setup :: Red Hat Build of Keycloak Workshop</title>
    <link rel="canonical" href="https://olleb.com/rhbk-workshop/setup.html">
    <link rel="prev" href="index.html">
    <link rel="next" href="secapp.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="./_/css/site.css">
<link rel="icon" href="./_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="./_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://olleb.com/rhbk-workshop">Red Hat Build of Keycloak Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kafka-tutorial/" target="_blank">Kafka</a>
            <a class="navbar-item" href="https://devsecops-workshop.github.io/" target="_blank">DevSecOps</a>
            <a class="navbar-item" href="https://acidonper.github.io/redhat-workshop-cicd-gitops/redhat-workshop-cicd-gitops/" target="_blank">CI/CD & GitOps</a>
            <a class="navbar-item" href="https://atarazana.github.io/gramola-gitops-guide/gramola-gitops-guide/" target="_blank">Gramola GitOps Guide</a>
            <a class="navbar-item" href="https://luisarizmendi.github.io/tutorial-secure-onboarding/" target="_blank">Secure Edge device onboarding with RHEL and FDO</a>
            <a class="navbar-item" href="https://xbryan1.github.io/rhte-2023-acm-docs/" target="_blank">Multicluster Application Deployment with Advanced Cluster Management and GitOps</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/java-inner-loop-dev-guide/java-inner-loop-dev-guide/index.html" target="_blank">Java Inner Loop Dev Guide</a>
            <a class="navbar-item" href="https://atarazana.github.io/kitchensink-guide/" target="_blank">Deploying JBoss EAP applications on OpenShift</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html">1. Environment Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tools">1.1. Workshop Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#deploy">1.2. Deploying Red Hat build of Keycloak on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#deploy-operator">1.2.1 Deploying Red Hat build of Keycloak on OpenShift using the Operator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#deploy-ipa">1.3 Deploying an Identity Management (IdM/FreeIPA) on Red Hat OpenShift</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="secapp.html">2. Authorization Services</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="secapp.html#presetup">2.1 Configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="secapp.html#quarkus-apps">2.2 Securing Web Applications</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="openid-jwt.html">3. OpenID Connect + JWT</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="openid-jwt.html#architecture">3.1. Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="openid-jwt.html#rhbk">3.2. Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="openid-jwt.html#backend">3.3. Backend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="openid-jwt.html#frontend">3.4. Frontend</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Red Hat Build of Keycloak Workshop</a></li>
    <li><a href="setup.html">1. Environment Setup</a></li>
  </ul>
</nav>
  <div style="padding: 0 0.5rem 0 0.75rem;">
    © 2024 - <a href="https://www.linkedin.com/in/angelolle/" target="_blank">Àngel Ollé Blázquez</a> | <a href="https://www.linkedin.com/in/david-borrego-guti%C3%A9rrez-868a2466/" target="_blank">David Borrego Gutiérrez</a>
  </div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Environment Setup</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This tutorial was developed and tested with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red Hat OpenShift <code>4.14</code></p>
</li>
<li>
<p>Red Hat build of Keycloak <code>22.0.6</code></p>
</li>
<li>
<p>FreeIPA <code>4.9.8</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tools"><a class="anchor" href="#tools"></a>Workshop Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following tools are required to run the exercises in this tutorial. Please ensure that they are installed and properly configured before proceeding with any of the tutorial chapters.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Tool</strong></th>
<th class="tableblock halign-left valign-top"><strong>Reference</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Red Hat OpenShift CLI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://access.redhat.com/downloads/content/290">OpenShift Container Platform downloads page</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/tasks/tools/">Kubernetes Documentation - Tasks - Install Tools</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kustomize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubectl.docs.kubernetes.io/installation/kustomize/">Install Kustomize</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Apache Maven</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://maven.apache.org/install.html">Installing Apache Maven</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenJDK 17</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/install/">How to download and install prebuilt OpenJDK packages</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VSCodium</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://vscodium.com/#install">VSCodium</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>httpie</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://httpie.io/">httpie</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The extensions source code used during this workshop can be found at the following URL:
<a href="https://github.com/aolle/rhbk-workshop/code" class="bare">https://github.com/aolle/rhbk-workshop/code</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy"><a class="anchor" href="#deploy"></a>Deploying Red Hat build of Keycloak on OpenShift</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="deploy-operator"><a class="anchor" href="#deploy-operator"></a>Deploying Red Hat build of Keycloak on OpenShift using the Operator</h3>
<div class="ulist">
<ul>
<li>
<p>Open a browser window and log in to the Red Hat OpenShift Container Platform web console.</p>
</li>
<li>
<p>From the Administrator perspective, click <code>Operators</code>, then <code>OperatorHub</code>.</p>
</li>
<li>
<p>In the Filter by keyword field, type <code>rhbk</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/setup/operatorhub-rhbk.png" alt="operatorhub rhbk">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the <code>Keycloak Operator</code> tile and click <code>Install</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/setup/install-rhbk-operator.png" alt="install rhbk operator">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On the Install Operator page, leave <code>stable-v22</code> from the list of available <code>Update Channel</code> options. The Operator supports only the <code>A specific namespace on the cluster</code> as installation mode. Create the <code>rhbk</code> project. Choose <code>Automatic</code> update approval.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/setup/rhbk-operator-opts.png" alt="rhbk operator opts">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <code>Install</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once installed, the <code>Keycloak Operator</code> should appear in the list of installed operators, accessible from the <code>Operators</code> menu under <code>Installed Operators</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/setup/rhbk-operator-installed.png" alt="rhbk operator installed">
</div>
</div>
<div class="paragraph">
<p>Keycloak requires specific prerequisites (unless it is initiated with <code>start-dev</code>) that we will proceed to install and configure.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s set up the database that Keycloak will rely on. In this workshop, we&#8217;ll opt for a PostgreSQL database installation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy the database instance:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n rhbk apply -f <a href="https://raw.githubusercontent.com/aolle/rhbk-workshop/main/code/install/postgres.yaml" class="bare">https://raw.githubusercontent.com/aolle/rhbk-workshop/main/code/install/postgres.yaml</a></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the secrets:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n rhbk create secret generic keycloak-db-secret \
  --from-literal=username=keycloak \
  --from-literal=password=keycloak</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The YAML file already includes the database&#8217;s <code>keycloak</code> username and password, which is adequate for a workshop. In a production environment, it&#8217;s essential to securely define these fields, and it&#8217;s recommended to store them in a secret.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy the Red Hat Build of Keycloak Instance:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n rhbk apply -f <a href="https://raw.githubusercontent.com/aolle/rhbk-workshop/main/code/install/rhbk.yaml" class="bare">https://raw.githubusercontent.com/aolle/rhbk-workshop/main/code/install/rhbk.yaml</a></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For the workshop, the Keycloak instance has been configured with plain HTTP enabled, and strict hostname resolution has been disabled. In production environments, it is necessary to configure TLS and set the hostname according to the specific requirements.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After deploying and ensuring the Keycloak instance is running successfully, we can access the administration console. The default credentials are generated randomly during the deployment. To retrieve them, we need to check the generated secrets as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtain the secrets and decode them.</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n rhbk get secret example-keycloak-initial-admin -o jsonpath='{.data.username}' | base64 --decode
oc -n rhbk get secret example-keycloak-initial-admin -o jsonpath='{.data.password}' | base64 --decode</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In production environments, it is advisable to change the randomly generated default credentials and enable multi-factor verification for enhanced security.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Try accessing the administration console using the provided credentials.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/setup/admin-console.png" alt="admin console">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy-ipa"><a class="anchor" href="#deploy-ipa"></a>1.3 Deploying an Identity Management (IdM/FreeIPA) on Red Hat OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how to install FreeIPA, an Identity Management (IdM) solution that combines Linux, 389 Directory Server, MIT Kerberos, NTP, DNS and Dogtag.</p>
</div>
<div class="paragraph">
<p><a href="https://www.freeipa.org/page/About" class="bare">https://www.freeipa.org/page/About</a></p>
</div>
<div class="paragraph">
<p>FreeIPA is the upstream version of Red Hat Identity Management.</p>
</div>
<div class="paragraph">
<p>Later on, we will see how we can integrate Red Hat build of Keycloak with IdM/FreeIPA.</p>
</div>
<div class="paragraph">
<p>To get started, stay logged in into your Red Hat OpenShift platform, and for convenience, select the <code>kc</code> project that has been created previously. Follow the steps below for deploying a FreeIPA instance on top of Red Hat OpenShift.</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># export the image that we are going to deploy
export IMG=quay.io/freeipa/freeipa-openshift-container:4.9.8
export IMG_BASE=${IMG}

# clone the repository and deploy the roles and scc
# if preferred, a remote build could be performed instead of cloning the repository
git clone <a href="https://github.com/freeipa/freeipa-openshift-container.git" class="bare">https://github.com/freeipa/freeipa-openshift-container.git</a>
cd freeipa-openshift-container/
kustomize build deploy/admin | oc create -f -

# create the ocp template and deploy it
make template-create
make template-new-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>Write down the <code>IPA_ADMIN_PASSWORD</code> and <code>IPA_DM_PASSWORD</code> displayed on the terminal; we will need it later.</p>
</div>
<div class="paragraph">
<p>Open the FreeIPA administration console to verify that the access and credentials are working properly.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/setup/freeIPAconsole.png" alt="freeIPAconsole">
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Red Hat Build of Keycloak Workshop</a></span>
  <span class="next"><a href="secapp.html">2. Authorization Services</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="./_/js/vendor/clipboard.js"></script>
<script src="./_/js/site.js"></script>
<script async src="./_/js/vendor/highlight.js"></script>
  </body>
</html>
