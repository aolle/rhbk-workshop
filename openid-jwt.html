<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenID + JWT :: Red Hat Build of Keycloak Workshop</title>
    <link rel="canonical" href="https://olleb.com/rhbk-workshop/openid-jwt.html">
    <link rel="prev" href="secapp.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="./_/css/site.css">
<link rel="icon" href="./_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="./_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://olleb.com/rhbk-workshop">Red Hat Build of Keycloak Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kafka-tutorial/" target="_blank">Kafka</a>
            <a class="navbar-item" href="https://devsecops-workshop.github.io/" target="_blank">DevSecOps</a>
            <a class="navbar-item" href="https://acidonper.github.io/redhat-workshop-cicd-gitops/redhat-workshop-cicd-gitops/" target="_blank">CI/CD & GitOps</a>
            <a class="navbar-item" href="https://atarazana.github.io/gramola-gitops-guide/gramola-gitops-guide/" target="_blank">Gramola GitOps Guide</a>
            <a class="navbar-item" href="https://luisarizmendi.github.io/tutorial-secure-onboarding/" target="_blank">Secure Edge device onboarding with RHEL and FDO</a>
            <a class="navbar-item" href="https://xbryan1.github.io/rhte-2023-acm-docs/" target="_blank">Multicluster Application Deployment with Advanced Cluster Management and GitOps</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/java-inner-loop-dev-guide/java-inner-loop-dev-guide/index.html" target="_blank">Java Inner Loop Dev Guide</a>
            <a class="navbar-item" href="https://atarazana.github.io/kitchensink-guide/" target="_blank">Deploying JBoss EAP applications on OpenShift</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html">1. Environment Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#tools">1.1. Workshop Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html#deploy">1.2. Deploying Red Hat build of Keycloak on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="setup.html#deploy-operator">1.2.1 Deploying Red Hat build of Keycloak on OpenShift using the Operator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#deploy-ipa">1.3 Deploying an Identity Management (IdM/FreeIPA) on Red Hat OpenShift</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="secapp.html">2. Authorization Services</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="secapp.html#presetup">2.1 Configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="secapp.html#quarkus-apps">2.2 Securing Web Applications</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="openid-jwt.html">3. OpenID Connect + JWT</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#architecture">3.1. Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rhbk">3.2. Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#backend">3.3. Backend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#frontend">3.4. Frontend</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Red Hat Build of Keycloak Workshop</a></li>
    <li><a href="openid-jwt.html">3. OpenID Connect + JWT</a></li>
  </ul>
</nav>
  <div style="padding: 0 0.5rem 0 0.75rem;">
    © 2024 - <a href="https://www.linkedin.com/in/angelolle/" target="_blank">Àngel Ollé Blázquez</a> | <a href="https://www.linkedin.com/in/david-borrego-guti%C3%A9rrez-868a2466/" target="_blank">David Borrego Gutiérrez</a>
  </div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">OpenID + JWT</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial demonstrates how to implement an OpenID Connect flow with a JWT implementation.</p>
</div>
<div class="paragraph">
<p>We will set up a new realm in Red Hat Build for Keycloak and configure it. Subsequently, we will deploy the stack and configure user access, enabling roles for various operations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Firstly, we require an instance of Red Hat Build for Keycloak to manage access across our applications. One advantage of implementing OpenID Connect with JWT is the seamless integration of various applications and frameworks, facilitated by libraries available for each.</p>
</div>
<div class="paragraph">
<p>In this instance, we will construct a comprehensive architecture involving several microservices. The frontend is developed in ReactJS, responsible for displaying the data.</p>
</div>
<div class="paragraph">
<p>The user backend microservice, built with Quarkus, showcases a straightforward integration between Keycloak and the application, thanks to its OpenID library.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-architecture-01.png" alt="frontend architecture 01">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rhbk"><a class="anchor" href="#rhbk"></a>Red Hat Build for Keycloak configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section outlines the process of creating a new realm using the OpenID Connect flow and provides guidance on its configuration.</p>
</div>
<div class="sect2">
<h3 id="_create_a_realm"><a class="anchor" href="#_create_a_realm"></a>Create a realm</h3>
<div class="paragraph">
<p>A realm in Red Hat Build for Keycloak functions as a domain where clients, users, roles, etc., can be configured. In this example, we offer an import containing the configuration to execute this workshop. Nevertheless, we are creating one from scratch to illustrate all the processes:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/rhbk-create-realm-01.png" alt="rhbk create realm 01">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_client"><a class="anchor" href="#_create_a_client"></a>Create a client</h3>
<div class="paragraph">
<p>A client in Red Hat Build for Keycloak serves as a consumer. Since we are employing an OpenID Connect flow, the selection of a standard or implicit flow depends on whether we are configuring a private or public client.</p>
</div>
<div class="paragraph">
<p>To register a new client, navigate to the Keycloak admin console and access the client options. In this section, locate the "Create client" option.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/rhbk-create-client-01.png" alt="rhbk create client 01">
</div>
</div>
<div class="paragraph">
<p>The next step depends on the flow we choose. In this workshop, we will opt for the standard flow for backend applications and the implicit flow for the frontend application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/rhbk-create-client-02.png" alt="rhbk create client 02">
</div>
</div>
<div class="paragraph">
<p>The final step involves configuring security parameters, including web origins, redirect URLs after a successful login, etc.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/rhbk-create-client-03.png" alt="rhbk create client 03">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backend"><a class="anchor" href="#backend"></a>Backend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now, let&#8217;s proceed to configure and secure a backend service. In this case, we are using Quarkus to develop the application.</p>
</div>
<div class="paragraph">
<p>The application serves as a backend service designed to store a list of users for a sports center.</p>
</div>
<div class="sect2">
<h3 id="_find_the_backend_url"><a class="anchor" href="#_find_the_backend_url"></a>Find the backend URL</h3>
<div class="paragraph">
<p>The front-end application consumes the back-end application, and it is crucial to be aware of the following URL:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get route -A | grep ms-users | awk '{print $3}'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_red_hat_build_for_keycloak_configuration"><a class="anchor" href="#_red_hat_build_for_keycloak_configuration"></a>Red Hat Build for Keycloak configuration</h3>
<div class="paragraph">
<p>The Keycloak instance includes a realm that has been configured with a dedicated client tailored for this workshop.</p>
</div>
<div class="paragraph">
<p>This application functions as a backend service utilizing a standard flow with a private client. In the upcoming section, you will find all the necessary configurations.</p>
</div>
<div class="paragraph">
<p>If you want to review the OpenID Connect client configuration and explore the Red Hat Build for Keycloak admin console, please navigate to the following section.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/backend-rhbk-config-01.png" alt="backend rhbk config 01">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_quarkus_configuration"><a class="anchor" href="#_quarkus_configuration"></a>Quarkus configuration</h3>
<div class="paragraph">
<p>Quarkus streamlines the security configuration in our backend services. To achieve this, we need to import the corresponding library. In this case, even though we are working with Red Hat Build for Keycloak, since it follows the OpenID Connect protocol, we will utilize the <code>quarkus-oidc</code> generic library.</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
      &lt;artifactId&gt;quarkus-oidc&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this stage, we only need to configure some properties to specify where and how to use the OIDC server:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.auth-server-url=http://localhost:8080/realms/jwt-demo
quarkus.oidc.client-id=padel-user-backend
quarkus.oidc.credentials.secret=0unvbdWCBWcFMQUyVukqA6TQuHHWjj9x</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The client secret is the password used by the client application, and it&#8217;s crucial to handle it securely.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the configurations in place, we can now proceed to secure the endpoints of our backend application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_secure_the_application"><a class="anchor" href="#_secure_the_application"></a>Secure the application</h3>
<div class="paragraph">
<p>Another advantage of using Quarkus is its user-friendly approach. Securing the application endpoints is simplified using annotations.</p>
</div>
<div class="paragraph">
<p>To secure applications, we have two options: a generic approach or a fine-grained one. The primary distinction lies in specifying user roles using <code>@RolesAllowed({ })</code> or not using <code>@Authenticated</code> in the application controllers.</p>
</div>
<div class="paragraph">
<p>Quarkus automatically handles client authentication, authorization, and roles management.</p>
</div>
</div>
<div class="sect2">
<h3 id="_crud_operations"><a class="anchor" href="#_crud_operations"></a>CRUD operations</h3>
<div class="paragraph">
<p>CRUD represents all the fundamental REST operations performed on a domain: create, read, update, and delete.</p>
</div>
<div class="paragraph">
<p>The level of security required varies depending on the operation. In this case, we will explore the security measures for each of the main options.</p>
</div>
<div class="sect3">
<h4 id="_how_to_get_an_access_token"><a class="anchor" href="#_how_to_get_an_access_token"></a>How to get an access token</h4>
<div class="paragraph">
<p>We will employ the <code>curl</code> bash client to test the remaining endpoints of the application. If you prefer a more visual approach, you can skip this section and proceed directly to the front-end application section.</p>
</div>
<div class="paragraph">
<p>To obtain an access token, we need to configure certain parameters that Red Hat Build for Keycloak requires.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">KCHOST=http://localhost:8080
REALM=jwt-demo
CLIENT_ID=padel-user-backend
CLIENT_SECRET=0unvbdWCBWcFMQUyVukqA6TQuHHWjj9x
UNAME=dborrego
PASSWORD=dborrego</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In each request, it&#8217;s necessary to include the access token. You can request one in the following manner:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ACCESS_TOKEN=`curl \
  -d "client_id=$CLIENT_ID" \
  -d "client_secret=$CLIENT_SECRET" \
  -d "username=$UNAME" \
  -d "password=$PASSWORD" \
  -d "grant_type=password" \
  "$KCHOST/realms/$REALM/protocol/openid-connect/token"  | jq -r '.access_token'`</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create"><a class="anchor" href="#_create"></a>Create</h4>
<div class="paragraph">
<p>Creating a new element in the domain is a restricted operation that should only be performed by an admin. We have a dedicated role for admins: <code>padel-users-admin</code>.</p>
</div>
<div class="paragraph">
<p>The application must prevent the connection and return a 403 error to any user without sufficient permissions:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  @POST
  @RolesAllowed({ "padel-users-admin" })
  public Uni&lt;User&gt; create(User user) {
    return Panache.withTransaction(user::persist);
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To test the creation of a user, you can use the following command:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl \
  -X POST \
  -H 'Authorization: Bearer '$ACCESS_TOKEN \
  -H 'Content-Type: application/json' \
  --data '{"name":"David", "year": 1988, "level": 3.12, "username":"dborrego"}' \
  localhost:8081/users
{"id":1,"username":"dborrego","name":"David","year":1988,"level":3.12}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_find"><a class="anchor" href="#_find"></a>Find</h4>
<div class="paragraph">
<p>We permit any user to retrieve their own information, so we require some filters.</p>
</div>
<div class="paragraph">
<p>The first control is to verify if the user is logged in with the correct role to access the application.</p>
</div>
<div class="paragraph">
<p>The second control ensures that the application confirms it is only attempting to retrieve its own user information. No user should be able to fetch another user&#8217;s data. A good analogy is a bank application where you can access your account information but not that of another account.</p>
</div>
<div class="paragraph">
<p>The final check involves extracting information from the token and incorporating it into the database query.</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  @GET
  @Path("/{id}")
  @RolesAllowed({ "padel-users-player" })
  public Uni&lt;User&gt; ListById(Long id) {
    final String username = securityIdentity.getPrincipal().getName();
    Log.info(String.format("User %s find user with id %d", username, id));
    return User.&lt;User&gt;findById(id)
        .onItem()
        .ifNotNull()
        .transform(user -&gt; {
          if (!username.equals(user.username)) {
            throw new WebApplicationException("El nombre del usuario no coincide", Response.Status.FORBIDDEN);
          }
          return user;
        });
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, you can attempt to retrieve your user information:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl \
  -H 'Authorization: Bearer '$ACCESS_TOKEN \
  localhost:8081/users/1
{"id":1,"username":"dborrego","name":"David","year":1988,"level":3.12}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="frontend"><a class="anchor" href="#frontend"></a>Frontend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, we aim to create a new record in our system, but we need to configure some security measures.</p>
</div>
<div class="sect2">
<h3 id="_find_the_front_end_application_url"><a class="anchor" href="#_find_the_front_end_application_url"></a>Find the front-end application URL</h3>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get route -A | grep frontend | awk '{print $3}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Upon entering the application, you should see a message similar to this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-02.png" alt="frontend 02">
</div>
</div>
<div class="paragraph">
<p>This message indicates that you have not logged into the application. So we have to log in. We need a user with enough roles to enter into the platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_user"><a class="anchor" href="#_create_the_user"></a>Create the user</h3>
<div class="paragraph">
<p>The initial step is to create a new user to demonstrate the entire configuration step by step. To do this, enter the Red Hat Build for Keycloak admin console, navigate to the "users" section, and click the "add user" button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-create-user-01.png" alt="frontend create user 01">
</div>
</div>
<div class="paragraph">
<p>In the subsequent screen, you can choose various properties for your new user. For now, we will only set the name.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-create-user-02.png" alt="frontend create user 02">
</div>
</div>
<div class="paragraph">
<p>After creating the user, the next step is to set a temporary or permanent credential for access. To accomplish this, navigate to the "Credentials" tab and click the "Set password" button.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For this example, you can use any password you prefer, but I recommend using a simple password like "reader".</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-create-user-03.png" alt="frontend create user 03">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_login_into_the_frontend_application"><a class="anchor" href="#_login_into_the_frontend_application"></a>Login into the frontend application</h3>
<div class="paragraph">
<p>Now that we have our new user, let&#8217;s return to the frontend URL and attempt to log in to the application. Click the green button, and the application will redirect you to the Keycloak login page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-login-01.png" alt="frontend login 01">
</div>
</div>
<div class="paragraph">
<p>Once you log in, you will be redirected to the main page, already signed in.</p>
</div>
<div class="paragraph">
<p>Now, you should see the following button:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-login-02.png" alt="frontend login 02">
</div>
</div>
<div class="paragraph">
<p>This indicates that you have successfully logged into the application. You may not see anything due to the ReactJS configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reactjs_configuration"><a class="anchor" href="#_reactjs_configuration"></a>ReactJS configuration</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This section presents JavaScript code to illustrate how straightforward it is to configure a ReactJS application.</p>
</div>
<div class="paragraph">
<p>Keycloak provides a library that can be easily integrated into any popular frontend framework. In this case, I&#8217;ve used <code>"keycloak-js": "^22.0.1"</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can examine and inspect the code. The variables <code>isAdmin</code> and <code>isUser</code> are responsible for controlling the user roles.</p>
</div>
<div class="paragraph">
<p>The Menu component renders the application menu based on these roles. Therefore, if the user is an admin, they will see the "users" option, and if they are a player, they can view the matches tab.</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">  const isAdmin = roles.includes('padel-users-admin');
  const isUser = roles.includes('padel-player');

  if (isAdmin || isUser) {
    return (
      &lt;Menu borderless&gt;
        {isAdmin &amp;&amp; (
          &lt;Menu.Item as={Link} to="/users"&gt;
            &lt;Button color="blue" size="small"&gt;
              &lt;Icon name="users" /&gt; Usuarios
            &lt;/Button&gt;
          &lt;/Menu.Item&gt;
        )}
        {isUser &amp;&amp; (
          &lt;Menu.Item as={Link} to="/matches"&gt;
            &lt;Button color="blue" size="small"&gt;
              &lt;Icon name="soccer" /&gt; Partidos
            &lt;/Button&gt;
          &lt;/Menu.Item&gt;
        )}
      &lt;/Menu&gt;
    );
  } else {
    return null;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we are working with a Single Page Application (SPA), users may be aware of the paths to access specific pages, such as the admin user&#8217;s page. The Keycloak library also manages this aspect:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-login-03.png" alt="frontend login 03">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_add_roles_to_the_user"><a class="anchor" href="#_add_roles_to_the_user"></a>Add roles to the user</h3>
<div class="paragraph">
<p>At this point, we understand how the ReactJS security model relies on the user roles present in the JWT token.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s proceed to add roles to users to enable private actions. The initial step is to return to the Red Hat Build for Keycloak admin page and locate the user named <code>reader</code>. Once you have identified the user, navigate to the "Role mapping" tab.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-add-role-01.png" alt="frontend add role 01">
</div>
</div>
<div class="paragraph">
<p>After clicking the "Assign role" button, Red Hat Build for Keycloak will display a list of all available roles in the system.</p>
</div>
<div class="paragraph">
<p>Select the role "padel-player" and click the "Assign" button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-add-role-02.png" alt="frontend add role 02">
</div>
</div>
<div class="paragraph">
<p>Now, you can return to the front page. It&#8217;s necessary to log out and log back in to refresh the JWT token.</p>
</div>
<div class="paragraph">
<p>After doing so, your user will have the assigned role, and the front end will display the "Matches" tab.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-add-role-03.png" alt="frontend add role 03">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_add_role_admin_to_manage_users"><a class="anchor" href="#_add_role_admin_to_manage_users"></a>Add role admin to manage users</h3>
<div class="paragraph">
<p>Now, repeat the process to add a role to the user named <code>reader</code>. This time, assign the role <code>padel-users-admin</code> to the user. After completing this step, you should be able to see the main page like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openid/frontend-add-role-admin-01.png" alt="frontend add role admin 01">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_call_the_backend_service"><a class="anchor" href="#_call_the_backend_service"></a>Call the backend service</h3>
<div class="paragraph">
<p>Now that we&#8217;ve learned how to manage security in both applications following the OpenID and JWT approach, let&#8217;s address the final point: integrating the two applications.</p>
</div>
<div class="paragraph">
<p>We need to propagate the JWT user token to the backend application. The backend receives the token and, based on the user&#8217;s role, allows or denies the operation.</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">export const createUser = async (domain, userToken, userData) =&gt; {
    const response = await fetch(`${BASE_URL}${domain}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${userToken}`
        },
        body: JSON.stringify(userData)
    });

    if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
    }

    return await response.json();
};</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="secapp.html">2. Authorization Services</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="./_/js/vendor/clipboard.js"></script>
<script src="./_/js/site.js"></script>
<script async src="./_/js/vendor/highlight.js"></script>
  </body>
</html>
